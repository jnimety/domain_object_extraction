<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Domain Object Extraction</title>
   
   
<style>
.why { font-size: 24px }
</style>

<style>
.icon img { vertical-align: middle }
</style>


<style>
html, body { margin: 0; padding: 0; }

body { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; }

a:link, a:visited { color: black; }

h1 { font-size: 30pt;  }
h2 { font-size: 28pt;  }
h3 { font-size: 25pt;  }
p, li, dt, dd, td, th { font-size: 18pt; }

pre { font-size: 14pt;  }
pre.small { font-size: 11pt; }

pre.code {
        background-color: azure;
        padding: 5px;
      }
     
ul { list-style-type: square; }    
   
.center { text-align: center; }   
     
.slide { page-break-after: always;
         min-height: 100mm;
         padding: 40px;
         
         border: 1px dotted black;

/*      
  background: -moz-linear-gradient( top, maroon, red);
*/
       }



/*
for princexml (CSS3 paged media support)
@page { size: A4 landscape }
*/
</style>

</head>
<body>

<div class="presentation">

<div class='slide middle'>
<p><!-- _S9SLIDE_  middle --></p>
<h2>Domain Object Refactoring</h2>
<p><img src="images/pulling_teeth.jpg" alt="" /></p>
<h3>Extracting Code into Classes and Modules</h3>

</div>
<div class='slide '>
<h1>Why?</h1><ul>
	<li class="why">Code Reuse</li>
	<li class="why">Readability</li>
	<li class="why">Wicked Fast Tests</li>
</ul>

</div>
<div class='slide '>
<h1>Case Study &#8211; Readability &amp; Reuse</h1><p>Often, code ripe for extraction is not overly complicated</p>
<!-- begin code{:lang=>"ruby"} -->
<div class='code'><pre class='brush: ruby toolbar: false gutter: true'>
class RegWatchRuleAlertScheduler &lt; ContinuityControl::AbstractScheduler

  def execute(reg_watch_alerts)
    reg_watch_alerts.each do |reg_watch_alert|

      # Not too complicated, but difficult to decipher without comments
      if (reg_watch_alert.regulator_ids &amp; organization.regulator_ids).any? ||
         (reg_watch_alert.regulator_ids - Agency.supervisory.map(&amp;:id)).any?

        # Do Stuff...
      end
    end
  end

end
</pre></div>
<!-- end code -->


</div>
<div class='slide '>
<h1>Case Study &#8211; Readability &amp; Reuse</h1><!-- begin code{:lang=>"ruby"} -->
<div class='code'><pre class='brush: ruby toolbar: false gutter: true'>
class RegWatchRuleAlertScheduler &lt; ContinuityControl::AbstractScheduler

  def execute(reg_watch_alerts)
    reg_watch_alerts.each do |reg_watch_alert|

      if ContinuityControl::RegulatorMatch.new(:reg_watch_alert =&gt; reg_watch_alert,
                                               :organization =&gt; organization).match?
        # Do Stuff...
      end
    end
  end

end

class ContinuityControl::RegulatorMatch
  attr_accessor :reg_watch_alert, :organization

  def initialize(opts = {})
    @reg_watch_alert = opts[:reg_watch_alert]; @organization = opts[:organization]
  end

  def match?
    primary_agency_match? || secondary_agency_present?
  end

  private

  def primary_agency_match?
    (@reg_watch_alert.regulator_ids &amp; @organization.regulator_ids).any?
  end

  def secondary_agency_present?
    (@reg_watch_alert.regulator_ids - Agency.supervisory.map(&amp;:id)).any?
  end
end
</pre></div>
<!-- end code -->


</div>
<div class='slide '>
<h1>Wicked Fast Tests</h1><p>With spec_helper (Rails, Factories, etc)</p>
<!-- begin code{:lang=>"bash"} -->
<div class='code'><pre class='brush: bash toolbar: false gutter: true'>
$ time (bundle exec rspec spec/with_spec_helper_spec.rb)

9.70s user 1.82s system 99% cpu 11.566 total
</pre></div>
<!-- end code -->

<p>Without spec_helper</p>
<!-- begin code{:lang=>"bash"} -->
<div class='code'><pre class='brush: bash toolbar: false gutter: true'>
$ time (rspec spec/without_spec_helper_spec.rb)

0.36s user 0.10s system 90% cpu 0.511 total
</pre></div>
<!-- end code -->


</div>
<div class='slide '>
<h1>Wicked Fast Tests</h1><!-- begin code{:lang=>"ruby"} -->
<div class='code'><pre class='brush: ruby toolbar: false gutter: true'>
#require 'spec_helper'
require 'lib/continuity_control/regulator_match'
require 'app/models/agency'
require 'ostruct'

describe ContinuityControl::RegulatorMatch do
  describe &quot;#match?&quot; do
    context &quot;given only a primary regulator match&quot; do
      it &quot;returns true&quot; do
        primary_regulator_id = 1

        Agency.stub! :supervisory =&gt; [OpenStruct.new(:id =&gt; primary_regulator_id)]
        organization = stub(:regulator_ids =&gt; [primary_regulator_id])
        reg_watch_alert = stub(:regulator_ids =&gt; [primary_regulator_id])

        regulator_match = ContinuityControl::RegulatorMatch.new(
            :organization =&gt; organization,
            :reg_watch_alert =&gt; reg_watch_alert)

        regulator_match.match?.should be_true
      end
    end

    #...

  end
end
</pre></div>
<!-- end code -->


</div>
<div class='slide '>
<h1>Resources</h1><ul>
	<li>Gary Bernhardt &#8211; Destroy All Software
	<ul>
		<li><a href="https://www.destroyallsoftware.com/screencasts">https://www.destroyallsoftware.com/screencasts</a></li>
	</ul></li>
	<li>Corey Haines &#8211; Fast Rails Tests
	<ul>
		<li><a href="http://confreaks.net/videos/641-gogaruco2011-fast-rails-tests">http://confreaks.net/videos/641-gogaruco2011-fast-rails-tests</a></li>
	</ul></li>
	<li>Steve Klabnik &#8211; Better Ruby Presenters
	<ul>
		<li><a href="http://blog.steveklabnik.com/2011/09/09/better-ruby-presenters.html">http://blog.steveklabnik.com/2011/09/09/better-ruby-presenters.html</a></li>
	</ul></li>
	<li>Ruby Rogues
	<ul>
		<li><a href="http://rubyrogues.com/">http://rubyrogues.com/</a></li>
	</ul></li>
</ul>

</div>
<div class='slide '>
<h1>Joel Nimety</h1><!-- begin left {} -->
<table width='100%'><tr><td width='50%' markdown='block' style='vertical-align: top;'>

<img src="images/joel_in_a_jar.jpg" alt="" />
</td>
<!-- end left -->

<!-- begin right {} -->
<td width='50%' markdown='block' style='vertical-align: top;'>

<ul>
	<li class="icon continuity"><img src="images/continuity_nu_32.png" alt="" /> SVP Technology, Continuity Control</li>
	<li class="icon twitter"><img src="images/twitter_32.png" alt="" /> @jnimety</li>
	<li class="icon email"><img src="images/email_32.png" alt="" /> jnimety@gmail.com</li>
</ul>
</td></tr></table>
<!-- end right -->
</div>


  </div> <!-- presentation -->
</body>
</html> 

